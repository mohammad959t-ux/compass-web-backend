# اختبارات Backend

## كيفية تشغيل الاختبارات

### تشغيل جميع الاختبارات مرة واحدة
```bash
npm test
```

### تشغيل الاختبارات في وضع Watch (مراقبة التغييرات)
```bash
npm run test:watch
```

### تشغيل واجهة الاختبارات التفاعلية
```bash
npm run test:ui
```

### تشغيل الاختبارات مع تقرير التغطية
```bash
npm run test:coverage
```

## متطلبات

- يجب أن تكون قاعدة بيانات MongoDB متاحة للاختبار
- يمكنك تحديد قاعدة بيانات الاختبار عن طريق متغير البيئة `MONGO_URI`
- إذا لم يتم تحديد `MONGO_URI`، سيتم استخدام `mongodb://localhost:27017/compass_test` افتراضياً

## الاختبارات المتاحة

### 1. Health Endpoint Tests (`health.test.ts`)
- اختبار endpoint الصحة الأساسي

### 2. Auth Endpoints Tests (`auth.test.ts`)
- تسجيل الدخول
- التحقق من المستخدم الحالي (`/auth/me`)
- تسجيل الخروج
- اختبارات المصادقة والأخطاء

### 3. Public Endpoints Tests (`public.test.ts`)
- قائمة الخدمات
- تفاصيل الخدمة حسب slug
- قائمة المشاريع
- تفاصيل المشروع حسب slug
- قائمة الباقات
- تفاصيل الباقة حسب slug
- قائمة المراجعات المعتمدة
- إنشاء lead جديد

## ملاحظات

- قبل تشغيل الاختبارات، يتم ملء قاعدة البيانات ببيانات تجريبية من `seed/seed.ts`
- بين كل اختبار، يتم تنظيف قاعدة البيانات
- بعد انتهاء جميع الاختبارات، يتم حذف قاعدة البيانات وإغلاق الاتصال
